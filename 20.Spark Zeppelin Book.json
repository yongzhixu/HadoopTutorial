{"paragraphs":[{"text":"%md\n### Let's make sure Spark is working from Zeppelin\nCheck spark version we're wroking with","user":"anonymous","dateUpdated":"2022-01-07T05:50:15+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":false,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Let's make sure Spark is working from Zeppelin</h3>\n<p>Check spark version we're wroking with</p>\n"}]},"apps":[],"jobName":"paragraph_1641534456136_-1221452095","id":"20220107-054736_1658412871","dateCreated":"2022-01-07T05:47:36+0000","dateStarted":"2022-01-07T05:48:49+0000","dateFinished":"2022-01-07T05:48:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2387"},{"text":"\n%md\nScala ","user":"anonymous","dateUpdated":"2022-01-07T05:50:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641534616595_-2079210635","id":"20220107-055016_1609673821","dateCreated":"2022-01-07T05:50:16+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:2388"},{"title":"Show spark context version","text":"sc.version\n","user":"anonymous","dateUpdated":"2022-01-07T05:55:09+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res0: String = 2.3.0.2.6.5.0-292\n"}]},"apps":[],"jobName":"paragraph_1641534529337_14654176","id":"20220107-054849_169315550","dateCreated":"2022-01-07T05:48:49+0000","dateStarted":"2022-01-07T05:49:15+0000","dateFinished":"2022-01-07T05:51:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2389"},{"title":"Download data from web","text":"%sh \nwget http://media.sundog-soft.com/hadoop/ml-100k/u.data -O /tmp/u.data \nwget http://media.sundog-soft.com/hadoop/ml-100k/u.item -O /tmp/u.item\necho \"Downloaded!\"","user":"anonymous","dateUpdated":"2022-01-07T05:54:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"editorMode":"ace/mode/sh","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"--2022-01-07 05:51:58--  http://media.sundog-soft.com/hadoop/ml-100k/u.data\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.217.166.145\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.217.166.145|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 2079229 (2.0M) [application/octet-stream]\nSaving to: ‘/tmp/u.data’\n\n     0K .......... .......... .......... .......... ..........  2%  110K 18s\n    50K .......... .......... .......... .......... ..........  4%  218K 13s\n   100K .......... .......... .......... .......... ..........  7% 26.4M 9s\n   150K .......... .......... .......... .......... ..........  9% 13.1M 6s\n   200K .......... .......... .......... .......... .......... 12%  223K 6s\n   250K .......... .......... .......... .......... .......... 14% 17.5M 5s\n   300K .......... .......... .......... .......... .......... 17%  219K 5s\n   350K .......... .......... .......... .......... .......... 19% 15.2M 5s\n   400K .......... .......... .......... .......... .......... 22%  524M 4s\n   450K .......... .......... .......... .......... .......... 24% 7.79M 4s\n   500K .......... .......... .......... .......... .......... 27% 23.0M 3s\n   550K .......... .......... .......... .......... .......... 29%  211K 3s\n   600K .......... .......... .......... .......... .......... 32% 36.4M 3s\n   650K .......... .......... .......... .......... .......... 34% 23.2M 3s\n   700K .......... .......... .......... .......... .......... 36% 23.7M 2s\n   750K .......... .......... .......... .......... .......... 39% 4.38M 2s\n   800K .......... .......... .......... .......... .......... 41%  615M 2s\n   850K .......... .......... .......... .......... .......... 44%  713M 2s\n   900K .......... .......... .......... .......... .......... 46% 26.3M 2s\n   950K .......... .......... .......... .......... .......... 49% 30.8M 1s\n  1000K .......... .......... .......... .......... .......... 51% 10.9M 1s\n  1050K .......... .......... .......... .......... .......... 54% 63.6M 1s\n  1100K .......... .......... .......... .......... .......... 56%  215K 1s\n  1150K .......... .......... .......... .......... .......... 59% 12.8M 1s\n  1200K .......... .......... .......... .......... .......... 61% 17.9M 1s\n  1250K .......... .......... .......... .......... .......... 64% 15.0M 1s\n  1300K .......... .......... .......... .......... .......... 66% 23.7M 1s\n  1350K .......... .......... .......... .......... .......... 68% 21.7M 1s\n  1400K .......... .......... .......... .......... .......... 71% 2.15M 1s\n  1450K .......... .......... .......... .......... .......... 73% 14.1M 1s\n  1500K .......... .......... .......... .......... .......... 76% 4.55M 1s\n  1550K .......... .......... .......... .......... .......... 78% 14.4M 0s\n  1600K .......... .......... .......... .......... .......... 81% 6.38M 0s\n  1650K .......... .......... .......... .......... .......... 83% 7.33M 0s\n  1700K .......... .......... .......... .......... .......... 86% 8.60M 0s\n  1750K .......... .......... .......... .......... .......... 88% 2.79M 0s\n  1800K .......... .......... .......... .......... .......... 91% 23.3M 0s\n  1850K .......... .......... .......... .......... .......... 93% 11.5M 0s\n  1900K .......... .......... .......... .......... .......... 96% 8.55M 0s\n  1950K .......... .......... .......... .......... .......... 98% 8.80M 0s\n  2000K .......... .......... ..........                      100%  108M=1.8s\n\n2022-01-07 05:52:03 (1.13 MB/s) - ‘/tmp/u.data’ saved [2079229/2079229]\n\n--2022-01-07 05:52:03--  http://media.sundog-soft.com/hadoop/ml-100k/u.item\nResolving media.sundog-soft.com (media.sundog-soft.com)... 52.216.243.12\nConnecting to media.sundog-soft.com (media.sundog-soft.com)|52.216.243.12|:80... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 236344 (231K) [application/octet-stream]\nSaving to: ‘/tmp/u.item’\n\n     0K .......... .......... .......... .......... .......... 21%  113K 2s\n    50K .......... .......... .......... .......... .......... 43%  224K 1s\n   100K .......... .......... .......... .......... .......... 64% 10.8M 0s\n   150K .......... .......... .......... .......... .......... 86%  876K 0s\n   200K .......... .......... ..........                      100%  189K=0.9s\n\n2022-01-07 05:52:04 (259 KB/s) - ‘/tmp/u.item’ saved [236344/236344]\n\nDownloaded!\n"}]},"apps":[],"jobName":"paragraph_1641534554823_-1743217576","id":"20220107-054914_926535872","dateCreated":"2022-01-07T05:49:14+0000","dateStarted":"2022-01-07T05:51:58+0000","dateFinished":"2022-01-07T05:52:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2390"},{"title":"Copy data to HDFS","text":"%sh\n\nhadoop fs -rm -r -f tmp/ml-100k\nhadoop fs -mkdir /tmp/ml-100k\n\nhadoop fs -put /tmp/u.data /tmp/ml-100k/\nhadoop fs -put /tmp/u.item /tmp/ml-100k/\n","user":"anonymous","dateUpdated":"2022-01-07T05:54:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sh","editOnDblClick":false},"title":true,"editorMode":"ace/mode/sh"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1641534713125_1228060262","id":"20220107-055153_586207065","dateCreated":"2022-01-07T05:51:53+0000","dateStarted":"2022-01-07T05:53:56+0000","dateFinished":"2022-01-07T05:54:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2391"},{"text":"final case class Rating(movieID: Int, rating: Int)\nval lines = sc.textFile(\"hdfs:///tmp/ml-100k/u.data\").map(x=> {val fields = x.split(\"\\t\"); Rating(fields(1).toInt, fields(2).toInt)})\n","user":"anonymous","dateUpdated":"2022-01-07T06:12:48+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one unchecked warning; re-run with -unchecked for details\ndefined class Rating\nlines: org.apache.spark.rdd.RDD[Rating] = MapPartitionsRDD[2] at map at <console>:27\n"}]},"apps":[],"jobName":"paragraph_1641534835514_-677849516","id":"20220107-055355_933737435","dateCreated":"2022-01-07T05:53:55+0000","dateStarted":"2022-01-07T05:59:50+0000","dateFinished":"2022-01-07T05:59:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2392","title":"RDD, Read movie data using Spark Context"},{"text":"import sqlContext.implicits._\n\nval ratingsDF = lines.toDF()\nratingsDF.printSchema()","user":"anonymous","dateUpdated":"2022-01-07T06:07:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import sqlContext.implicits._\nratingsDF: org.apache.spark.sql.DataFrame = [movieID: int, rating: int]\nroot\n |-- movieID: integer (nullable = false)\n |-- rating: integer (nullable = false)\n\n"}]},"apps":[],"jobName":"paragraph_1641535097569_1463645893","id":"20220107-055817_561365378","dateCreated":"2022-01-07T05:58:17+0000","dateStarted":"2022-01-07T06:00:42+0000","dateFinished":"2022-01-07T06:00:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2393","title":"Tranform to DataFrame"},{"text":"val topMovieIDs = ratingsDF.groupBy(\"movieID\").count().orderBy(desc(\"count\")).cache()\ntopMovieIDs.show()","user":"anonymous","dateUpdated":"2022-01-07T06:08:33+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"topMovieIDs: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [movieID: int, count: bigint]\n+-------+-----+\n|movieID|count|\n+-------+-----+\n|     50|  584|\n|    258|  509|\n|    100|  508|\n|    181|  507|\n|    294|  485|\n|    286|  481|\n|    288|  478|\n|      1|  452|\n|    300|  431|\n|    121|  429|\n|    174|  420|\n|    127|  413|\n|     56|  394|\n|      7|  392|\n|     98|  390|\n|    237|  384|\n|    117|  378|\n|    172|  368|\n|    222|  365|\n|    204|  350|\n+-------+-----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1641535242017_-1542196404","id":"20220107-060042_1826332506","dateCreated":"2022-01-07T06:00:42+0000","dateStarted":"2022-01-07T06:02:12+0000","dateFinished":"2022-01-07T06:02:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2394","title":"Aggregate"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641535301781_1901752821","id":"20220107-060141_1005275798","dateCreated":"2022-01-07T06:01:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:2395","text":"ratingsDF.registerTempTable(\"ratings\")","dateUpdated":"2022-01-07T06:06:30+0000","dateFinished":"2022-01-07T06:05:53+0000","dateStarted":"2022-01-07T06:05:53+0000","title":"Register DataFrame as Table","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641535523002_-1606865989","id":"20220107-060523_1174372702","dateCreated":"2022-01-07T06:05:23+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2995","text":"%sql\nselect * from ratings limit 10","dateUpdated":"2022-01-07T06:09:14+0000","dateFinished":"2022-01-07T06:09:20+0000","dateStarted":"2022-01-07T06:09:15+0000","title":"SQL query Registered Table","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"movieID\trating\n50\t5\n172\t5\n133\t1\n242\t3\n302\t3\n377\t1\n51\t2\n346\t1\n474\t4\n265\t2\n"}]}},{"text":"%sql\nselect * from ratings where rating> 4 limit 10","user":"anonymous","dateUpdated":"2022-01-07T06:10:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641535754763_1848349344","id":"20220107-060914_1003691894","dateCreated":"2022-01-07T06:09:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3181","dateFinished":"2022-01-07T06:10:29+0000","dateStarted":"2022-01-07T06:10:29+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"movieID\trating\n50\t5\n172\t5\n465\t5\n1014\t5\n222\t5\n387\t5\n95\t5\n234\t5\n603\t5\n327\t5\n"}]}},{"text":"%sql\nselect rating, count(1) as count from ratings group by rating","user":"anonymous","dateUpdated":"2022-01-07T06:45:07+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641535820206_1768949864","id":"20220107-061020_405397019","dateCreated":"2022-01-07T06:10:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3360","dateFinished":"2022-01-07T06:45:09+0000","dateStarted":"2022-01-07T06:45:07+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"rating\tcount\n1\t6111\n3\t27145\n5\t21203\n4\t34174\n2\t11370\n"}]}},{"text":"final case class Movie(movieID: Int, title: String)\n// double check data \nval linesRaw = sc.textFile(\"hdfs:///tmp/ml-100k/u.item\")\nprintln(linesRaw.first())\n// linesRaw.collect.foreach(m=>println(m))\nval lines = sc.textFile(\"hdfs:///tmp/ml-100k/u.item\").map(x=> {val fields = x.split('|'); Movie(fields(0).toInt, fields(1))})\nprintln(lines.first())","user":"anonymous","dateUpdated":"2022-01-07T06:41:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","title":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641535868921_1825785432","id":"20220107-061108_912054857","dateCreated":"2022-01-07T06:11:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3583","dateFinished":"2022-01-07T06:40:35+0000","dateStarted":"2022-01-07T06:40:34+0000","title":"RDD, Read movie item using Spark Context","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one unchecked warning; re-run with -unchecked for details\ndefined class Movie\nlinesRaw: org.apache.spark.rdd.RDD[String] = hdfs:///tmp/ml-100k/u.item MapPartitionsRDD[218] at textFile at <console>:40\n1|Toy Story (1995)|01-Jan-1995||http://us.imdb.com/M/title-exact?Toy%20Story%20(1995)|0|0|0|1|1|1|0|0|0|0|0|0|0|0|0|0|0|0|0\nlines: org.apache.spark.rdd.RDD[Movie] = MapPartitionsRDD[221] at map at <console>:42\nMovie(1,Toy Story (1995))\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641536061611_29067721","id":"20220107-061421_816643744","dateCreated":"2022-01-07T06:14:21+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3966","text":"import sqlContext.implicits._\nval movieDF = lines.toDF()\n\nmovieDF.show()","dateUpdated":"2022-01-07T06:40:41+0000","dateFinished":"2022-01-07T06:40:43+0000","dateStarted":"2022-01-07T06:40:41+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import sqlContext.implicits._\nmovieDF: org.apache.spark.sql.DataFrame = [movieID: int, title: string]\n+-------+--------------------+\n|movieID|               title|\n+-------+--------------------+\n|      1|    Toy Story (1995)|\n|      2|    GoldenEye (1995)|\n|      3|   Four Rooms (1995)|\n|      4|   Get Shorty (1995)|\n|      5|      Copycat (1995)|\n|      6|Shanghai Triad (Y...|\n|      7|Twelve Monkeys (1...|\n|      8|         Babe (1995)|\n|      9|Dead Man Walking ...|\n|     10|  Richard III (1995)|\n|     11|Seven (Se7en) (1995)|\n|     12|Usual Suspects, T...|\n|     13|Mighty Aphrodite ...|\n|     14|  Postino, Il (1994)|\n|     15|Mr. Holland's Opu...|\n|     16|French Twist (Gaz...|\n|     17|From Dusk Till Da...|\n|     18|White Balloon, Th...|\n|     19|Antonia's Line (1...|\n|     20|Angels and Insect...|\n+-------+--------------------+\nonly showing top 20 rows\n\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641536120244_-1957113370","id":"20220107-061520_1447847005","dateCreated":"2022-01-07T06:15:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4047","text":"movieDF.registerTempTable(\"titles\")","dateUpdated":"2022-01-07T06:40:51+0000","dateFinished":"2022-01-07T06:40:52+0000","dateStarted":"2022-01-07T06:40:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641536216955_-1285787836","id":"20220107-061656_648649765","dateCreated":"2022-01-07T06:16:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4154","text":"%sql\nselect t.title, count(1) cnt from titles t join ratings r on t.movieID = r.movieID group by t.title order by cnt desc limit 10","dateUpdated":"2022-01-07T06:45:32+0000","dateFinished":"2022-01-07T06:45:27+0000","dateStarted":"2022-01-07T06:45:21+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tcnt\nStar Wars (1977)\t584\nContact (1997)\t509\nFargo (1996)\t508\nReturn of the Jedi (1983)\t507\nLiar Liar (1997)\t485\nEnglish Patient, The (1996)\t481\nScream (1996)\t478\nToy Story (1995)\t452\nAir Force One (1997)\t431\nIndependence Day (ID4) (1996)\t429\n"}]}},{"text":"%sql\n","user":"anonymous","dateUpdated":"2022-01-07T06:18:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1641536315332_1245793172","id":"20220107-061835_1947945059","dateCreated":"2022-01-07T06:18:35+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4235"}],"name":"Spark Zeppelin Book","id":"2GSDH5NDZ","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}